# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Firebase Hosting on merge
on:
  push:
    branches:
      - main # Or your default branch where you want to trigger deployment

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest # GitHub-hosted runner with Ubuntu

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # --- START OF FLUTTER SPECIFIC STEPS ---
      # Set up Flutter environment
      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.32.3'
          channel: 'stable' # Use 'beta' or 'master' if you are on those channels

      # Get Flutter dependencies
      - name: Get Flutter dependencies
        run: flutter pub get

      # Build the Flutter web project
      - name: Build Flutter Web
        run: flutter build web --release # This command builds your Flutter app for the web, creating the necessary files
      # --- END OF FLUTTER SPECIFIC STEPS ---

      # Deploy to Firebase Hosting
      - name: Deploy to Firebase Hosting
        uses: FirebaseExtended/action-hosting-deploy@v0 # Official action for deploying to Firebase Hosting
        with:
          repoToken: '${{ secrets.GITHUB_TOKEN }}'
          # Ensure this secret is correctly configured in your GitHub repository settings under Secrets -> Actions
          # Its name must EXACTLY match the one you added for your Firebase service account/token.
          firebaseServiceAccount: '${{ secrets.FIREBASE_SERVICE_ACCOUNT_AI_AGENT }}'
          channelId: live # Specifies that the deployment should go to the live channel of your Firebase Hosting
          projectId: ai-agent # Your actual Firebase Project ID
          # If you have multiple hosting sites configured in firebase.json, you might need a 'target' here.
          # For example: target: your-hosting-target-name
